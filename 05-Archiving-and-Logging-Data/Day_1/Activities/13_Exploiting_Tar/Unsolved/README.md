## Activity File: Exploiting `tar`

In this exercise, you'll play the role of a penetration tester hunting for vulnerabilities in a target system's backup procedures.

In particular, you will use the `wildpwn.py` tool to verify that the system's current configuration is vulnerable to this kind of privilege escalation attack.

Afterwards, you will research and suggest two mitigation strategies to protect the server in the future.

### Instructions

1. Log in as `jane` and use `sudo -l` to verify that you have no `sudo` rights. Use the following credentials:

    - Username: `jane`
    - password: `password`

### Verifying the automated backups

In this step, we're going to look for automated `tar` backup files that we can attempt to exploit.

2. As `jane`, navigate to your `~/Documents` directory in the terminal. Are there any archive files present?

- What might the name of the file indicate? Use `ls -lat` to check the ownership of the archive. Why wouldn't this file belong to `jane`?

- Delete the archive file. You'll now need to wait a minute or two to test to see if the archive file comes back. If the archive file comes back, this means it can be potentially exploited with a `wildcard attack`.

### Downloading the Script

Now that we've confirmed there is a regenerating archive file that is potentially backing up the contents of `jane`'s `Document` directory, we're going to: 

- Download the `wildpwn` exploit tool, 
- Run it to create payloads, and then 
- Let the automated `tar` backup system task also archive the malicious payload files, which should "enable" our exploit. 

Note that there is a subdirectory, `ExploitTar`, that has been created for your pen-testing tasks. Use this folder to run `wildpwn` in.

3. Download the [wildpwn.py](https://raw.githubusercontent.com/localh0t/wildpwn/master/wildpwn.py) attack tool to your `~/Documents/ExploitTar` directory. Do this from the command line, _not_ the browser.

     _**Hint**: Use `wget` or `curl`._

    - Navigate to and check the contents of this directory before we execute the python script.

### Generating the Payload

Now we want to run this exploit tool so that it can generate malicious payload files. Remember, that the exploit here becomes staged when the system's automated backup task archives Jane's documents into the `tar` file that we found earlier.

4. Now use `wildpwn.py` to generate the malicious `tar` payload files within the `/home/jane/Documents/ExploitTar` directory, which you expect to be frequently backed up.

   - If you are unsure how to use this file: after downloading the script, run `python wildpwn.py -h` to look up usage. If you are stuck, ask your instructor or TA for the proper command.

   - Run `ls` to check the directory for our newly created files. 

Just to reiterate again, this python script generated a **payload**, or _malicious files used for staging an exploit_ into our `ExploitTar` directory.

### Verify the Payload is Staged

Now for the waiting game! As the regular user, `jane`, you planted some malicious files, that, when automatically backed up by the system, should creat our exploit file.

5. After waiting a minute or two, re-run the `ls` command but with the proper options to see the new _hidden_ subdirectory. Navigate into that subdirectory and list its _hidden_ file. This is the one you'll want to run to execute the `wildcard attack` exploit.

### Execute the Exploit

We'll now attempt to run the exploit!

6. While still in the _hidden_ subdirectory, execute the _hidden_ file within the terminal.

- What happened to your command prompt that confirms this exploit worked?

### Become a Super User

Now as `root`, we'll want to make `jane` a superuser with `sudo` access.

7. Add `jane` to `/etc/sudoers` by running `visudo`. This will allow our user `jane` to run commands with superuser privileges. Also, specify the `NOPASSWD` rule for this user.

- If you're not sure how to do this, there is already a similar user set up this way under `root`'s **specifications**.

### Test Your New Powers and Cover Your Tracks

8. Log back in as `jane` and verify that you can run commands with `sudo`. Then, remove the entire `ExploitTar` directory to cover your tracks.

### Preventive Measures

9. After verifying that you can indeed escalate privileges and modify the system to catastrophic effect, identify two ways to prevent this attack in the future.

--- 

Â© 2020 Trilogy Education Services, a 2U, Inc. brand.  All Rights Reserved.
